{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/GPS/Documents/GitHub/CDA2026/app/api/login/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\r\nimport { cookies } from \"next/headers\"\r\nimport { createClient } from \"@supabase/supabase-js\"\r\nimport type { SessionUser } from \"@/lib/auth\"\r\n\r\nexport async function POST(request: Request) {\r\n  try {\r\n    const { username, password } = await request.json()\r\n\r\n    if (!username || !password) {\r\n      return NextResponse.json({ error: \"Faltan credenciales\" }, { status: 400 })\r\n    }\r\n\r\n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\r\n    const serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY\r\n\r\n    if (!supabaseUrl || !serviceKey) {\r\n      return NextResponse.json({ error: \"Supabase no está configurado\" }, { status: 500 })\r\n    }\r\n\r\n    const supabaseAdmin = createClient(supabaseUrl, serviceKey, {\r\n      auth: {\r\n        autoRefreshToken: false,\r\n        persistSession: false,\r\n      },\r\n    })\r\n\r\n    const { data: user, error } = await supabaseAdmin\r\n      .from(\"users\")\r\n      .select(\"id, username, nombre, rol, password, cargo\")\r\n      .eq(\"username\", username)\r\n      .single()\r\n\r\n    if (error || !user) {\r\n      return NextResponse.json({ error: \"Usuario no encontrado\" }, { status: 401 })\r\n    }\r\n\r\n    if (user.password !== password) {\r\n      return NextResponse.json({ error: \"Contraseña incorrecta\" }, { status: 401 })\r\n    }\r\n\r\n    const sessionUser: SessionUser = {\r\n      id: user.id,\r\n      username: user.username,\r\n      nombre: user.nombre,\r\n      rol: user.rol,\r\n      cargo: user.cargo,\r\n    }\r\n\r\n    const response = NextResponse.json({ success: true, user: sessionUser })\r\n    response.cookies.set(\"simple_session\", JSON.stringify(sessionUser), {\r\n      httpOnly: true,\r\n      sameSite: \"lax\",\r\n      path: \"/\",\r\n    })\r\n\r\n    return response\r\n  } catch (error) {\r\n    console.error(\"Error en login:\", error)\r\n    return NextResponse.json({ error: \"Error en el servidor\" }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAEA;;;AAGO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEjD,IAAI,CAAC,YAAY,CAAC,UAAU;YAC1B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,MAAM;QACN,MAAM,aAAa,QAAQ,GAAG,CAAC,yBAAyB;QAExD,IAAI,CAAC,eAAe,CAAC,YAAY;YAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA+B,GAAG;gBAAE,QAAQ;YAAI;QACpF;QAEA,MAAM,gBAAgB,IAAA,yMAAY,EAAC,aAAa,YAAY;YAC1D,MAAM;gBACJ,kBAAkB;gBAClB,gBAAgB;YAClB;QACF;QAEA,MAAM,EAAE,MAAM,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,cACjC,IAAI,CAAC,SACL,MAAM,CAAC,8CACP,EAAE,CAAC,YAAY,UACf,MAAM;QAET,IAAI,SAAS,CAAC,MAAM;YAClB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAwB,GAAG;gBAAE,QAAQ;YAAI;QAC7E;QAEA,IAAI,KAAK,QAAQ,KAAK,UAAU;YAC9B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAwB,GAAG;gBAAE,QAAQ;YAAI;QAC7E;QAEA,MAAM,cAA2B;YAC/B,IAAI,KAAK,EAAE;YACX,UAAU,KAAK,QAAQ;YACvB,QAAQ,KAAK,MAAM;YACnB,KAAK,KAAK,GAAG;YACb,OAAO,KAAK,KAAK;QACnB;QAEA,MAAM,WAAW,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,MAAM;QAAY;QACtE,SAAS,OAAO,CAAC,GAAG,CAAC,kBAAkB,KAAK,SAAS,CAAC,cAAc;YAClE,UAAU;YACV,UAAU;YACV,MAAM;QACR;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAuB,GAAG;YAAE,QAAQ;QAAI;IAC5E;AACF"}}]
}